# Story 4.10: Expense Reports - Comparison Tools

## Status
Ready for Review

## Story
As a decision maker,
I want period comparisons, benchmarking, and what-if scenarios,
So that I can evaluate performance and simulate budget changes.

## Acceptance Criteria
1. Period Comparison
   - Dual date range selector
   - Overlay/side-by-side toggle
   - Variance highlighting
2. Category Benchmarking
   - Benchmark dataset integration
   - Performance indicators against benchmark
   - Recommendations engine
3. What-If Scenarios
   - Adjustable parameters (e.g., % changes by category)
   - Impact visualization
   - Save scenarios for later

## Tasks / Subtasks
- [ ] Build dual-range comparison control and chart overlays
  - [ ] Synchronized date pickers for both periods
  - [ ] Visual diff highlighting in charts
  - [ ] Percentage and absolute variance displays
  - [ ] Mobile-friendly comparison UI
- [ ] Integrate benchmark data source and indicators
  - [ ] Industry averages for hospitality sector
  - [ ] Regional benchmarks for Manali area
  - [ ] Seasonal benchmarks for mountain tourism
  - [ ] Custom benchmark import capability
- [ ] Implement scenario editor and saved scenarios list
  - [ ] Drag sliders for percentage adjustments
  - [ ] Category-specific scenario rules
  - [ ] Scenario comparison matrix
  - [ ] Export scenarios to Excel
- [ ] Property comparison features
  - [ ] Side-by-side property metrics
  - [ ] Cross-property expense patterns
  - [ ] Unified vs separate views toggle

## Dev Notes
- Reference: `docs/implementation-plans/expense-reports-ui-improvement-plan.md` (Phase 2 - Task 2.3)
- Data modeling for scenarios and benchmarks
- Persist scenarios per property
- Architecture:
  - `ComparisonContext` for period management
  - `BenchmarkService` for external data
  - `ScenarioEngine` for what-if calculations
- Performance:
  - Scenario calculation: <100ms
  - Comparison render: <300ms
  - Support 10+ active scenarios
- Guest House Context:
  - Peak vs Off-season comparisons crucial
  - Old Manali vs Baror property comparison
  - Weather impact scenarios (heating costs)
  - Festival period benchmarks
- Benchmark Sources:
  - Himachal Tourism statistics
  - Local hotel association data
  - Historical property data

## Testing
- [ ] Variance calculations correct and highlighted
- [ ] Overlay vs side-by-side visual modes toggle
- [ ] Scenario save/load and impact updates
- [ ] Benchmark data accuracy and updates
- [ ] Mobile comparison gestures work
- [ ] Real-time updates in comparison mode
- [ ] Export includes all comparison data
- [ ] Performance with multiple scenarios
- [ ] Cross-property comparisons accurate
- [ ] Dark mode comparison visuals

## Success Metrics
- Comparison usage: >50% compare periods
- Scenario creation: >30% create what-if scenarios
- Benchmark reference: >40% check benchmarks
- Decision impact: 25% faster budget decisions

## Integration Points
- Budget system: Scenarios affect budget planning
- Forecasting: Historical comparisons inform predictions
- Reports: Include comparison insights
- Multi-property: Unified comparison dashboard

## Dependencies
- 4.17: Real-time Updates & Auto-refresh — ensures dual-range views stay in sync with fresh data
- 4.18: Dark Mode & Print Support — theme and print styles for comparison visuals
- 4.19: PWA & Offline Support — offline access to saved comparisons and scenarios
- 4.20: Mobile UI Enhancements — mobile gestures and layout for side-by-side views
- 4.21: Chart Export & Sharing — export comparison overlays and scenario matrices
- 4.25: React Query + TanStack Table — data fetching for dual periods and benchmarks
- 4.22/4.23: Weather & Local Events — contextual overlays to explain variance
- 4.24: Mobile Push Notifications — optional alerts for saved comparisons crossing thresholds

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-16 | 1.0 | Initial story creation | Team |
| 2025-08-16 | 1.1 | Added benchmarks, property comparison, seasonal context | Enhancement |
