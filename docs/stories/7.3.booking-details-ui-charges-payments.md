# Status
Planned

# Story: Booking Details UI â€” Charges & Payments
Enhance `src/components/BookingDetails.tsx` to manage charges and payments with summaries.

## Prerequisites
- Services available (`7.2`).

## Acceptance Criteria
- New Charges section with Food typeahead and Misc entry; edit and void actions.
- New Payments section with Add Payment and Add Refund; void actions.
- Summary panel shows charges_total, discounts_total, taxes_total, gross_total, payments_total, refunds_total, balance_due, and status_derived. Totals are sourced from `public.booking_financials`.
- Legacy booking payment fields are not user-editable in this view.
- Responsive UI consistent with current styling and UX patterns.

## Tasks
- Add UI panels and modals for add/edit flows.
- Integrate typeahead using `menuService.ts` search.
- Wire CRUD calls to services.
- Compute and show aggregates from `booking_financials`.
- Add input validation and basic error toasts.

## Dev Notes
- Keep UI lean; avoid clutter by using modals and collapsible sections.
- Consider optimistic updates with rollback if service call fails.
 - Discounts are separate charge rows (`charge_type = 'discount'`). Render discount lines distinctly (e.g., negative styling). Do not implement per-line discount fields.
 - Use `booking_financials.last_activity_at` to decide when to refresh the summary after mutations.

## Testing
- Add/edit/void charge; add/refund/void payment; verify totals update instantly.
- Print preview of invoice to confirm consistency with invoice story.
 - For DB-level manual tests, follow the `set_config('request.jwt.claims', ...)` pattern from story `7.1`.

## Change Log
- 2025-08-22: Story drafted.
