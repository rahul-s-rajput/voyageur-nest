# Story 4.7: Expense Reports - Mobile-Optimized Views

## Status
Ready for Review

## Story
As a mobile user,
I want swipeable tabs, collapsible card layouts, and optimized charts,
So that I can efficiently navigate and view reports on small screens.

## Acceptance Criteria
1. Swipeable Tab Navigation
   - Smooth swipe animations
   - Tab indicators
   - Haptic feedback support (where available)
   - Pull-to-refresh gesture support
   - Horizontal scroll indicators for wide content
2. Collapsible Card Layout
   - Smooth expand/collapse animations
   - Remembers user preferences (localStorage)
   - One-tap expansion
   - Bottom sheet filters (slide-up panel)
   - Floating action button for quick actions
3. Optimized Chart Sizes
   - Charts fit mobile viewport
   - Readable labels (minimum 12px font)
   - Touch-friendly tooltips (44x44px minimum)
   - Pinch-to-zoom for detailed views
   - Landscape mode optimization
4. PWA Features
   - Install as app prompt
   - Offline mode with cached data
   - Background sync for updates
   - Push notifications for alerts
5. Mobile-Specific UI
   - Compact view toggle
   - Native date/time pickers
   - Mobile-optimized modals (full-screen)
   - Touch gesture zones (20px from edges)

## Tasks / Subtasks
- [ ] Implement `SwipeableTabs` (Swiper) with tab bar and sync state
  - [ ] Add pull-to-refresh with loading indicator
  - [ ] Implement haptic feedback API
  - [ ] Add swipe gesture zones
- [ ] Build collapsible/accordion cards for sections
  - [ ] Bottom sheet implementation for filters
  - [ ] Floating action button with speed dial
  - [ ] Persist expand/collapse state
- [ ] Apply responsive chart container and typography scale
  - [ ] Implement pinch-to-zoom (Hammer.js)
  - [ ] Landscape orientation layouts
  - [ ] Dynamic font scaling
- [ ] Persist user view preferences (localStorage)
- [ ] PWA implementation
  - [ ] Service worker registration
  - [ ] Offline cache strategy
  - [ ] App manifest configuration
  - [ ] Install prompt handling
- [ ] Mobile-specific optimizations
  - [ ] Virtual scrolling for long lists
  - [ ] Lazy loading for charts
  - [ ] Touch event optimization

## Dev Notes
- Reference: `docs/implementation-plans/expense-reports-ui-improvement-plan.md` (Phase 1 - Task 1.3)
- Component guide: `SwipeableTabs`, `ResponsiveChartContainer`
- Suggested locations: 
  - `src/components/Reports/mobile/`
  - `src/serviceWorker.ts`
  - `public/manifest.json`
- Breakpoints:
  - Mobile: 320px - 767px
  - Tablet: 768px - 1023px
  - Desktop: 1024px+
- Touch targets: 44x44px minimum, 8px spacing
- Libraries:
  - Swiper.js (tab navigation)
  - Hammer.js (touch gestures)
  - Workbox (PWA/service worker)
  - React-Intersection-Observer (lazy loading)
- Performance targets:
  - First Contentful Paint: <1.5s on 3G
  - Time to Interactive: <3s on 3G
  - Smooth 60fps scrolling
- Guest House Context:
  - Staff often check reports on phones during property rounds
  - Network can be slow in mountain areas (optimize for offline)
  - Multi-property switching needs to be quick

## Testing
- [ ] Swipe between tabs on iOS/Android
- [ ] Expand/collapse behaviors and persistence
- [ ] Charts readable and interactive on small screens
- [ ] Accessibility: focus order, keyboard support, ARIA for accordion
- [ ] PWA installation on Android/iOS
- [ ] Offline mode: cached data displays correctly
- [ ] Pull-to-refresh works smoothly
- [ ] Bottom sheet gestures feel native
- [ ] Performance on low-end devices (budget Android phones)
- [ ] Network: works on 2G/3G connections
- [ ] Landscape orientation: layout adjusts properly
- [ ] Touch gestures: no accidental triggers
- [ ] Memory usage: no leaks with heavy usage
- [ ] Battery impact: minimal drain

## Success Metrics
- Mobile usage: >40% of total usage
- PWA installation rate: >20% of mobile users
- Offline usage: Successfully handles 100% of offline scenarios
- Touch interaction success: >95% first attempt
- Performance: <3s TTI on 3G

## Integration Points
- Real-time updates: WebSocket reconnection on network change
- Multi-property: Quick property switcher in mobile header
- Notifications: Budget alerts, anomaly detection
- Deep linking: Direct links to specific report sections

## Dependencies
- 4.20: Mobile UI Enhancements — provides FAB, bottom sheet filters, gesture primitives reused here
- 4.19: PWA & Offline Support — install prompt, offline cache, background sync for mobile usage
- 4.17: Real-time Updates & Auto-refresh — live refresh hooks and reconnection logic
- 4.18: Dark Mode & Print Support — shared theme tokens for mobile components
- 4.24: Mobile Push Notifications — alerts integration and permission flows
- 4.25: React Query + TanStack Table — caching, background revalidation for mobile data
- 4.21: Chart Export & Sharing — mobile-native share and image export from charts
- 4.22/4.23: Weather & Local Events Correlation — optional overlays/context in mobile charts

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-16 | 1.0 | Initial story creation | Team |
| 2025-08-16 | 1.1 | Added PWA, offline, gesture support | Enhancement |
