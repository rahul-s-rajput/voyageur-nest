# Story 4.12: Expense Reports - Custom Dashboard Builder

## Status
Ready for Review

## Story
As a power user,
I want a drag-and-drop dashboard with configurable widgets,
So that I can tailor the reports view to my workflow.

## Acceptance Criteria
1. Widget Library
   - 15+ widget types
   - Widget preview
   - Configuration panel
2. Layout Manager
   - Grid-based positioning
   - Responsive breakpoints
   - Save layouts
3. Widget Configuration
   - Data source selection
   - Color themes
   - Size options

## Tasks / Subtasks
- [ ] Implement widget registry with metadata
  - [ ] 15+ widget types catalog
  - [ ] Widget preview thumbnails
  - [ ] Category organization
  - [ ] Search and filter widgets
- [ ] Add grid layout manager (e.g., React Grid Layout)
  - [ ] Drag-and-drop with snap-to-grid
  - [ ] Responsive breakpoint management
  - [ ] Collision detection and auto-arrangement
  - [ ] Undo/redo for layout changes
  - [ ] Mobile-specific layouts
- [ ] Build widget config panel and persistence
  - [ ] Data source selector with preview
  - [ ] Color theme customization
  - [ ] Size and position controls
  - [ ] Advanced options per widget type
  - [ ] Cloud sync for layouts
- [ ] Template system
  - [ ] Pre-built dashboard templates
  - [ ] Role-based templates (Manager, Staff, Owner)
  - [ ] Import/export dashboard configs
  - [ ] Share dashboards with team

## Dev Notes
- Reference: `docs/implementation-plans/expense-reports-ui-improvement-plan.md` (Phase 3 - Task 3.2)
- Data model: `ReportDashboard`, `Widget`, `WidgetConfig` (see spec)
- Architecture:
  - `WidgetRegistry` for component management
  - `LayoutEngine` for grid calculations
  - `DashboardStore` for state management
  - `TemplateService` for presets
- Libraries:
  - React-Grid-Layout for drag-and-drop
  - React-Rnd for resize/drag alternative
  - Zustand for dashboard state
- Performance:
  - Widget lazy loading
  - Virtual scrolling for many widgets
  - <100ms drag response
- Widget Types:
  - KPI Cards (4 variants)
  - Charts (Line, Bar, Pie, Area, Scatter)
  - Tables (Basic, Pivot, Grouped)
  - Gauges and Progress
  - Heatmaps and Treemaps
  - Custom HTML/Markdown
- Guest House Context:
  - Daily Operations Dashboard
  - Financial Overview Dashboard
  - Property Comparison Dashboard
  - Seasonal Analysis Dashboard

## Testing
- [ ] Add/drag/resize/persist widgets across breakpoints
- [ ] Config changes applied and saved
- [ ] Performance under many widgets (20+)
- [ ] Template import/export works
- [ ] Mobile layouts separate from desktop
- [ ] Real-time data updates in widgets
- [ ] Undo/redo maintains state correctly
- [ ] Cross-browser drag-and-drop
- [ ] Touch gestures on tablets
- [ ] Dark mode widget rendering
- [ ] Permission-based widget access
- [ ] Cloud sync reliability

## Success Metrics
- Adoption rate: >60% customize dashboards
- Widget usage: Average 8 widgets per dashboard
- Template usage: >70% start from templates
- Time saved: 50% reduction in report creation

## Integration Points
- Real-time data: All widgets support live updates
- Export: Custom dashboards exportable to PDF
- Scheduled reports: Use custom dashboard layouts
- Multi-property: Property-specific dashboards
- Permissions: Role-based widget visibility

## Dependencies
- 4.17: Real-time Updates & Auto-refresh — streams live data into widgets with diff updates
- 4.18: Dark Mode & Print Support — theme tokens applied to widgets and editor; print styles
- 4.19: PWA & Offline Support — offline dashboards, cache hydration, and background sync
- 4.20: Mobile UI Enhancements — mobile layouts, gestures, and bottom sheets for widget config
- 4.21: Chart Export & Sharing — export/share custom dashboards and individual widgets
- 4.24: Mobile Push Notifications — widget-sourced alerts (budgets/anomalies)
- 4.25: React Query + TanStack Table — data layer and caching for widgets and tables
- 4.22/4.23: Weather & Local Events — optional context widgets/overlays

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-16 | 1.0 | Initial story creation | Team |
| 2025-08-16 | 1.1 | Added templates, widget catalog, guest house context | Enhancement |
