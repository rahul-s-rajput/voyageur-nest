# Story 4.19: Reports & Analytics - PWA & Offline Support

## Status
Ready for Review

## Story
As a mobile user,
I want to install the app and view cached reports offline,
So that I can access data anywhere.

## Acceptance Criteria
1. Install prompt on supported mobile browsers (Add to Home Screen)
2. Service worker provides offline caching for shell + reports
3. Cached reports viewable offline with clear offline indicator
4. Background sync to refresh data when connection returns
5. App icon, splash screen, and manifest metadata complete

## Tasks / Subtasks
- [ ] Manifest updates (name, short_name, icons, theme/background colors)
- [ ] Service worker (Workbox) with caching strategies
  - [ ] App shell: cache-first + versioned
  - [ ] API/data: stale-while-revalidate with background sync
  - [ ] Images/charts: cache-first with max entries
  - [ ] SW update flow and cache invalidation
- [ ] Offline data store (IndexedDB) for recent reports/KPIs
- [ ] Offline indicator UI and fallback screens
- [ ] Register SW and handle install prompt UX
- [ ] Background sync queue for pending actions

## Dev Notes
- References: improvement plan (PWA/offline), `public/manifest.json`
- Existing: `public/notifications-sw.js` (web push) â€“ integrate or keep separate from PWA SW
- Suggested locations:
  - `public/manifest.json`
  - `src/serviceWorker.ts`
  - `src/lib/offlineStore.ts` (IndexedDB/Dexie)
  - `src/components/ReportsAnalytics/offline/OfflineBanner.tsx`
- Consider `vite-plugin-pwa` or Workbox CLI for SW generation
- Foundation: Story 4.0 provides base architecture
- Location: New ReportsAnalytics section (not ExpenseManagement)
- No legacy code dependencies

## Testing
- [ ] Install on Android/iOS (where supported)
- [ ] Offline: open Reports; KPIs and recent charts render from cache
- [ ] Background sync refreshes data on reconnect
- [ ] SW update prompts user to refresh
- [ ] Storage limits and purge policy verified

## Success Metrics
- PWA install rate: >20% of mobile users
- Offline success: 100% core views load without network

## Integration Points
- Real-time features queue updates while offline
- Export: allow offline queueing of share actions if needed

## Prerequisites
- Story 4.0 (Reports & Analytics Foundation) must be completed

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-16 | 1.0 | Initial story creation | Team |
