# Status
Planned

# Story: Telegram Bot â€” Add Charge and Payment Flows
Extend `supabase/functions/telegram-bot/features/booking.ts` to support creating and viewing booking charges and payments.

## Prerequisites
- Foundation and booking flows exist; property scope is available in context.
- Schema/services ready (`7.1`, `7.2`).

## Acceptance Criteria
- Booking summary shows totals and balance due.
- Inline actions: `âž• Add Charge`, `ðŸ’³ Add Payment`, `ðŸ§¾ View Charges`, `ðŸ’° View Payments`.
- Add Charge wizard: Food (typeahead menu items) or Misc (free text), qty, unit price, optional discount, confirmation, save.
- Add Payment wizard: amount, mode buttons (cash, upi, card, bank, other), optional backdate via quick date picker, confirmation, save.
- View lists: last 5 charges/payments with pagination and `Void` actions.

## Tasks
- Define callback data scheme for new actions.
- Implement wizards using grammY conversation/wizard patterns.
- Query `menu_items` for Food typeahead (by `ilike` and `property_id`).
- Call services to create/void items; refresh summary after actions.

## Dev Notes
- Keep messages concise and mobile-first.
- Add simple guardrails for repeated taps (rate limit already in foundation).

## Testing
- Manual E2E: happy-path adds, voiding, pagination.
- Negative: invalid booking, cross-property attempts.

## Change Log
- 2025-08-22: Story drafted.
