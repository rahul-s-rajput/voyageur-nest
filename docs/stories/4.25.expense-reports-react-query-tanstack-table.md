# Story 4.25: React Query + TanStack Table Adoption

## Status
Ready for Review

## Story
As an engineer,
I want standardized data fetching and tables (React Query + TanStack Table),
So that the reports are fast, consistent, and easy to maintain.

## Acceptance Criteria
1. React Query (TanStack Query)
   - QueryClient configured with sensible defaults (retry, staleTime, cacheTime)
   - All expense-report data fetchers use `useQuery`/`useMutation`
   - Loading skeletons and error boundaries standardized
   - Invalidation after create/update/approve actions
   - Devtools enabled in development
2. TanStack Table
   - Consistent table component for lists (transactions, vendors, approvals)
   - Column sorting, resizing, filtering, pinning
   - Sticky header, virtualization (react-window)
   - Accessible cells/headers and keyboard nav

## Tasks / Subtasks
- [ ] Bootstrap
  - [ ] `QueryClientProvider` at app root; React Query Devtools in dev
  - [ ] Shared `fetcher` with auth headers and error mapping
- [ ] Data Layer
  - [ ] Move data calls to `src/services/*` + hooks in `src/hooks/*`
  - [ ] Standardize keys: `['expenses', 'list', filters]`, etc.
  - [ ] Mutations with optimistic updates where safe
- [ ] Table Layer
  - [ ] `DataTable` component wrapping TanStack Table
  - [ ] Virtualized rows; column config via metadata
  - [ ] Row selection, bulk actions, CSV export hooks
- [ ] Migrations
  - [ ] Replace ad-hoc fetching/tables in Reports module
  - [ ] Update tests and story docs

## Dev Notes
- References: improvement plan (Performance, Filters, Drill-down)
- Suggested locations:
  - `src/lib/queryClient.ts`
  - `src/components/Reports/DataTable/`
  - `src/services/` + `src/hooks/`
- Performance goals: <100ms cached view; <500ms cold fetch; <16ms row render

## Testing
- [ ] Cache behavior and invalidations correct
- [ ] Tables: sorting/filtering/pinning works with 10k rows
- [ ] Keyboard navigation and a11y checks
- [ ] Error states and retries behave as designed

## Success Metrics
- Code reuse: 1 table component across reports
- Reduced bugs: fewer fetch-related issues
- Performance: TTI and interaction targets met

## Integration Points
- Filters (Story 4.8), Drill-down (Story 4.9), Exports (Story 4.13)
- Real-time (Story 4.17): invalidate or patch cache on live updates

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-16 | 1.0 | Initial story creation | Team |
